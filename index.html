<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Princess Warrior Quest</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; background: #87CEEB; }
    canvas { display: block; margin: auto; background: linear-gradient(to top, #87CEEB, #ffffff); }
    .controls {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 20px; z-index: 100;
    }
    button {
      width: 60px; height: 60px;
      background: #ff99bb;
      border: none; border-radius: 50%;
      font-size: 24px; color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="450"></canvas>
  <div class="controls">
    <button id="left">⯇</button>
    <button id="jump">⭡</button>
    <button id="right">⯈</button>
  </div>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const princess = {
      x: 100, y: 300, width: 40, height: 60,
      color: '#ff69b4',
      vx: 0, vy: 0,
      speed: 3, jumpStrength: -10,
      onGround: false
    };

    const keys = { left: false, right: false, jump: false };
    const gravity = 0.5;
    let messageOpacity = 0;
    let sparkleParticles = [];
    let coinMessage = '';
    let coinMessageTimer = 0;

    const platforms = [
      { x: 0, y: 400, width: 1200, height: 50 },
      { x: 300, y: 330, width: 120, height: 20 },
      { x: 500, y: 270, width: 100, height: 20 },
    ];

    const coins = [
      { x: 320, y: 280, collected: false },
      { x: 520, y: 220, collected: false }
    ];

    const enemies = [
      { x: 650, y: 370, width: 30, height: 30, vx: 1, color: '#ff6666' }
    ];

    const flag = { x: 1100, y: 350, width: 20, height: 50, reached: false };

    function drawPrincess() {
      ctx.fillStyle = princess.color;
      ctx.fillRect(princess.x - cameraX, princess.y, princess.width, princess.height);
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(princess.x - cameraX + 10, princess.y + 20, 5, 0, Math.PI * 2);
      ctx.arc(princess.x - cameraX + 30, princess.y + 20, 5, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.arc(princess.x - cameraX + 10, princess.y + 20, 2, 0, Math.PI * 2);
      ctx.arc(princess.x - cameraX + 30, princess.y + 20, 2, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawPlatforms() {
      ctx.fillStyle = '#228B22';
      platforms.forEach(p => {
        ctx.fillRect(p.x - cameraX, p.y, p.width, p.height);
      });
    }

    function drawCoins() {
      coins.forEach(c => {
        if (!c.collected) {
          ctx.beginPath();
          ctx.arc(c.x - cameraX, c.y, 10, 0, Math.PI * 2);
          ctx.fillStyle = 'gold';
          ctx.fill();
        }
      });
    }

    function drawEnemies() {
      enemies.forEach(e => {
        ctx.fillStyle = e.color;
        ctx.fillRect(e.x - cameraX, e.y, e.width, e.height);
      });
    }

    function drawFlag() {
      ctx.fillStyle = '#66ccff';
      ctx.fillRect(flag.x - cameraX, flag.y, flag.width, flag.height);
    }

    function showMessage() {
      if (messageOpacity < 1) messageOpacity += 0.01;
      ctx.globalAlpha = messageOpacity;
      for (let i = 0; i < 100; i++) {
        ctx.fillStyle = `hsla(${Math.random()*360},100%,75%,0.6)`;
        ctx.beginPath();
        ctx.arc(Math.random()*canvas.width, Math.random()*canvas.height, 2, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.fillStyle = '#ff69b4';
      ctx.font = '24px Comic Sans MS';
      ctx.textAlign = 'center';
      ctx.fillText('I love you my pretty princess', 400, 230);
      ctx.globalAlpha = 1;
    }

    function drawMagicTrail() {
      sparkleParticles.push({ x: princess.x, y: princess.y + princess.height / 2, alpha: 1 });
      sparkleParticles.forEach(p => {
        ctx.globalAlpha = p.alpha;
        ctx.fillStyle = 'pink';
        ctx.beginPath();
        ctx.arc(p.x - cameraX, p.y, 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
        p.alpha -= 0.02;
      });
      sparkleParticles = sparkleParticles.filter(p => p.alpha > 0);
    }

    let cameraX = 0;

    function update() {
      if (!flag.reached) {
        if (keys.left) princess.vx = -princess.speed;
        else if (keys.right) princess.vx = princess.speed;
        else princess.vx = 0;

        if (keys.jump && princess.onGround) {
          princess.vy = princess.jumpStrength;
          princess.onGround = false;
        }

        princess.vy += gravity;
        princess.x += princess.vx;
        princess.y += princess.vy;

        princess.onGround = false;
        platforms.forEach(p => {
          if (
            princess.x + princess.width > p.x && princess.x < p.x + p.width &&
            princess.y + princess.height > p.y && princess.y + princess.height < p.y + p.height &&
            princess.vy >= 0
          ) {
            princess.y = p.y - princess.height;
            princess.vy = 0;
            princess.onGround = true;
          }
        });

        coins.forEach(c => {
          if (!c.collected &&
              princess.x < c.x + 10 && princess.x + princess.width > c.x - 10 &&
              princess.y < c.y + 10 && princess.y + princess.height > c.y - 10) {
            c.collected = true;
            coinMessage = "Yay! Coin! ✨";
            coinMessageTimer = 60;
          }
        });

        enemies.forEach(e => {
          e.x += e.vx;
          if (e.x < 600 || e.x > 700) e.vx *= -1;
          if (
            princess.x < e.x + e.width && princess.x + princess.width > e.x &&
            princess.y < e.y + e.height && princess.y + princess.height > e.y
          ) {
            princess.x = 100;
            princess.y = 300;
            cameraX = 0;
          }
        });

        if (
          princess.x + princess.width > flag.x && princess.x < flag.x + flag.width &&
          princess.y + princess.height > flag.y && princess.y < flag.y + flag.height
        ) {
          flag.reached = true;
        }

        cameraX = princess.x - 100;
      }

      if (coinMessageTimer > 0) coinMessageTimer--;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlatforms();
      drawCoins();
      drawEnemies();
      drawFlag();
      drawMagicTrail();
      drawPrincess();

      if (flag.reached) showMessage();

      if (coinMessageTimer > 0) {
        ctx.fillStyle = '#fff';
        ctx.font = '20px Comic Sans MS';
        ctx.textAlign = 'center';
        ctx.fillText(coinMessage, princess.x - cameraX + 20, princess.y - 10);
      }
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    document.getElementById('left').addEventListener('touchstart', () => keys.left = true);
    document.getElementById('left').addEventListener('touchend', () => keys.left = false);
    document.getElementById('right').addEventListener('touchstart', () => keys.right = true);
    document.getElementById('right').addEventListener('touchend', () => keys.right = false);
    document.getElementById('jump').addEventListener('touchstart', () => keys.jump = true);
    document.getElementById('jump').addEventListener('touchend', () => keys.jump = false);

    document.getElementById('left').addEventListener('mousedown', () => keys.left = true);
    document.getElementById('left').addEventListener('mouseup', () => keys.left = false);
    document.getElementById('right').addEventListener('mousedown', () => keys.right = true);
    document.getElementById('right').addEventListener('mouseup', () => keys.right = false);
    document.getElementById('jump').addEventListener('mousedown', () => keys.jump = true);
    document.getElementById('jump').addEventListener('mouseup', () => keys.jump = false);

    gameLoop();
  </script>
</body>
</html>
